# IAP

​		

## IAP简介

​		IAP是In Application Programming的首字母缩写，IAP是用户自己的[程序](https://baike.baidu.com/item/程序/71525)在运行过程中对User Flash的部分区域进行烧写，目的是为了在产品发布后可以方便地通过预留的通信口对产品中的固件程序进行更新升级。



## IAP流程

​		在设计固件程序时编写两个项目代码，第一个项目程序（Bootloader）不执行正常的功能操作，而只是通过USART、IIC等通讯方式接收程序或数据，执行对第二部分程序（App）的更新，第二个项目代码（App）才是真正的功能代码。

​		IAP的Bootloader程序通过ISP、JTAG方式烧录到单片机起始Flash地址，则单片机每次复位后会先执行Bootloader程序，会判断用户是否需要升级和是否跳转到App程序等处理。IAP的实现方式和OTA实现方式类似，可分为差分升级、全量升级等，一般IAP用全量升级方式足够，大致步骤如下：

1. ​	检查是否需要升级App程序
2. ​	如果不需要升级，并且已有App程序，则跳转到第四步
3. ​	执行更新操作
4. ​	跳转到App程序
5. ​	停在Boot程序，等待下个指令

​		

## IAP要点

​		IAP实现组装部分：

1. 单片机（Flash读写、Flash分区划分）

2. 上位机（平台选用、通讯协议选择、通讯方式选择）

